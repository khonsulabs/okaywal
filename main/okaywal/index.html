<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A write-ahead log (WAL) implementation for Rust."><meta name="keywords" content="rust, rustlang, rust-lang, okaywal"><title>okaywal - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="../crates.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../okaywal/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../okaywal/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Crate okaywal</a></h2><div class="sidebar-elems"><div class="block"><ul><li class="version">Version 0.1.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul></div><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#types">Type Definitions</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../okaywal/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><div id="settings-menu" tabindex="-1">
                                <a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div>
                        </div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">okaywal</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/okaywal/lib.rs.html#1-1242">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A <a href="https://en.wikipedia.org/wiki/Write-ahead_logging">write-ahead log (WAL)</a>
implementation for Rust.</p>
<blockquote>
<p>There’s The Great Wall, and then there’s this: an okay WAL.</p>
</blockquote>
<p><strong>WARNING: This crate is early in development. Please do not use in any projects
until this has been incorporated into
<a href="https://github.com/khonsulabs/sediment">Sediment</a> and shipping as part of
<a href="https://github.com/khonsulabs/nebari">Nebari</a>.</strong></p>
<p><img src="https://img.shields.io/badge/unsafe-forbid-success" alt="okaywal forbids unsafe code" />
<a href="https://crates.io/crates/okaywal"><img src="https://img.shields.io/crates/v/okaywal.svg" alt="crate version" /></a>
<a href="https://github.com/khonsulabs/okaywal/actions?query=workflow:Tests"><img src="https://img.shields.io/github/workflow/status/khonsulabs/okaywal/Tests/main" alt="Live Build Status" /></a>
<a href="https://khonsulabs.github.io/okaywal/coverage/"><img src="https://khonsulabs.github.io/okaywal/coverage/badge.svg" alt="HTML Coverage Report for main branch" /></a>
<a href="https://khonsulabs.github.io/okaywal/main/okaywal"><img src="https://img.shields.io/badge/docs-main-informational" alt="Documentation" /></a></p>
<p>This crate exposes a WAL that supports:</p>
<ul>
<li>Atomic and Durable writes from multiple threads.</li>
<li>Random access for previously written data.</li>
<li>Automatic checkpointing to allow reusing disk space and
preventing the WAL from growing too large.</li>
<li>Interactive recovery process with basic data versioning support.</li>
</ul>
<h3 id="basic-how-to"><a href="#basic-how-to">Basic How-To</a></h3>
<p><a href="struct.WriteAheadLog.html#method.recover"><code>WriteAheadLog::recover()</code></a> is used to create or recover a WAL
in a given directory. To open a log, an implementator of
<a href="trait.Checkpointer.html"><code>Checkpointer</code></a> must be provided. This trait is how
OkayWAL communicates with your code when recovering or checkpointing a log.</p>
<p>The <a href="https://github.com/khonsulabs/okaywal/blob/main/examples/basic.rs">basic example</a> shows this process with many comments
describing how OkayWAL works.</p>

<div class='information'><div class='tooltip ignore'>ⓘ</div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore"><code><span class="comment">// Open a log using an Checkpointer that echoes the information passed into each</span>
<span class="comment">// function that the Checkpointer trait defines.</span>
<span class="kw">let</span> <span class="ident">log</span> <span class="op">=</span> <span class="ident">WriteAheadLog::recover</span>(<span class="string">&quot;my-log&quot;</span>, <span class="ident">LoggingCheckpointer</span>)<span class="question-mark">?</span>;

<span class="comment">// Begin writing an entry to the log.</span>
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">writer</span> <span class="op">=</span> <span class="ident">log</span>.<span class="ident">write</span>()<span class="question-mark">?</span>;

<span class="comment">// Each entry is one or more chunks of data. Each chunk can be individually</span>
<span class="comment">// addressed using its LogPosition.</span>
<span class="kw">let</span> <span class="ident">record</span> <span class="op">=</span> <span class="ident">writer</span>.<span class="ident">write_chunk</span>(<span class="string">&quot;this is the first entry&quot;</span>.<span class="ident">as_bytes</span>())<span class="question-mark">?</span>;

<span class="comment">// To fully flush all written bytes to disk and make the new entry</span>
<span class="comment">// resilliant to a crash, the writer must be committed.</span>
<span class="ident">writer</span>.<span class="ident">commit</span>()<span class="question-mark">?</span>;</code></pre></div>
<h3 id="multi-threaded-ordering-of-entries"><a href="#multi-threaded-ordering-of-entries">Multi-threaded Ordering of Entries</a></h3>
<p>This WAL implementation has a simple approach to ordering entries: the order in
which <code>WriteAheadLog::write</code> is called controls the order in which the entries
are read. When only one thread is writing to the WAL at any given time, this
order is expected and predictable.</p>
<p>However, when multiple threads are writing to the WAL at the same time, there is
a range of time in which the entry is started, written, and then synchronized to
disk. If these threads are operating on an in-memory state while also writing to
the WAL, there is opportunity for information stored in the WAL to be out of
order relative to the operations being performed in-memory.</p>
<p>OkayWAL does not provide any facilities for helping sort out these
inconsistencies. As such, it may be important to store extra information inside
of the log entries to help ensure the exact state can be reproduced from the log
entries despite these inconsistencies.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ChunkRecord.html" title="okaywal::ChunkRecord struct">ChunkRecord</a></div><div class="item-right docblock-short"><p>A record of a chunk that was written to a <a href="struct.WriteAheadLog.html" title="WriteAheadLog"><code>WriteAheadLog</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Configuration.html" title="okaywal::Configuration struct">Configuration</a></div><div class="item-right docblock-short"><p>Controls a <a href="struct.WriteAheadLog.html" title="WriteAheadLog"><code>WriteAheadLog</code></a>’s behavior.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Entry.html" title="okaywal::Entry struct">Entry</a></div><div class="item-right docblock-short"><p>A stored entry inside of a <a href="struct.WriteAheadLog.html" title="WriteAheadLog"><code>WriteAheadLog</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.EntryChunk.html" title="okaywal::EntryChunk struct">EntryChunk</a></div><div class="item-right docblock-short"><p>A chunk of data previously written using <a href="struct.EntryWriter.html#method.write_chunk" title="EntryWriter::write_chunk"><code>EntryWriter::write_chunk</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.EntryId.html" title="okaywal::EntryId struct">EntryId</a></div><div class="item-right docblock-short"><p>The unique id of an entry written to a <a href="struct.WriteAheadLog.html" title="WriteAheadLog"><code>WriteAheadLog</code></a>. These IDs are
ordered by the time the <a href="struct.EntryWriter.html" title="EntryWriter"><code>EntryWriter</code></a> was created for the entry written with this id.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.EntryWriter.html" title="okaywal::EntryWriter struct">EntryWriter</a></div><div class="item-right docblock-short"><p>Writes an entry to a <a href="struct.WriteAheadLog.html" title="WriteAheadLog"><code>WriteAheadLog</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.File.html" title="okaywal::File struct">File</a></div><div class="item-right docblock-short"><p>An open file.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.LockedFile.html" title="okaywal::LockedFile struct">LockedFile</a></div><div class="item-right docblock-short"><p>An open file that has an exclusive file lock.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.LogPosition.html" title="okaywal::LogPosition struct">LogPosition</a></div><div class="item-right docblock-short"><p>The position of a chunk of data within a <a href="struct.WriteAheadLog.html" title="WriteAheadLog"><code>WriteAheadLog</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.LogReader.html" title="okaywal::LogReader struct">LogReader</a></div><div class="item-right docblock-short"><p>Reads a collection of <a href="struct.Entry.html" title="Entry"><code>Entry</code></a>s from a <a href="struct.WriteAheadLog.html" title="WriteAheadLog"><code>WriteAheadLog</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RecoveredSegment.html" title="okaywal::RecoveredSegment struct">RecoveredSegment</a></div><div class="item-right docblock-short"><p>Information about an individual segment of a <a href="struct.WriteAheadLog.html" title="WriteAheadLog"><code>WriteAheadLog</code></a> that is being
recovered.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.VoidCheckpointer.html" title="okaywal::VoidCheckpointer struct">VoidCheckpointer</a></div><div class="item-right docblock-short"><p>A <a href="trait.Checkpointer.html" title="Checkpointer"><code>Checkpointer</code></a> that does not attempt to recover any existing data.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.WriteAheadLog.html" title="okaywal::WriteAheadLog struct">WriteAheadLog</a></div><div class="item-right docblock-short"><p>A Write-Ahead Log that enables atomic, durable writes.</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Error.html" title="okaywal::Error enum">Error</a></div><div class="item-right docblock-short"><p>An error from a <a href="struct.WriteAheadLog.html" title="WriteAheadLog"><code>WriteAheadLog</code></a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.ReadChunkResult.html" title="okaywal::ReadChunkResult enum">ReadChunkResult</a></div><div class="item-right docblock-short"><p>The result of reading a chunk from a log segment.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Recovery.html" title="okaywal::Recovery enum">Recovery</a></div><div class="item-right docblock-short"><p>Determines whether to recover a segment or not.</p>
</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Checkpointer.html" title="okaywal::Checkpointer trait">Checkpointer</a></div><div class="item-right docblock-short"><p>Customizes recovery and checkpointing behavior for a <a href="struct.WriteAheadLog.html" title="WriteAheadLog"><code>WriteAheadLog</code></a>.</p>
</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Result.html" title="okaywal::Result type">Result</a></div><div class="item-right docblock-short"><p>A result from <code>okwal</code>.</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="okaywal" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.63.0 (4b91a6ea7 2022-08-08)" ></div>
</body></html>